---
title: "Gun Violence in the United States"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 7
)

library(tidyverse)
library(plotly)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

```{r, include=FALSE}
gun_violence_data = read_csv("./gun_violence_data/gun_violence_data_2013_2018.csv")

gun_v_tidy = 
	gun_violence_data %>% 
	select(date:city_or_county, n_killed, n_injured, latitude, longitude) %>% 
	separate(date, into = c("year", "month", "day"), sep = "-") %>% 
	mutate(n_affected = n_killed + n_injured) %>%
	filter(n_affected > 0) %>% 
	mutate(mass_shooting = ifelse(n_affected >= 4, "Yes", "No"))
```

### Gun Violence as a Paramount Public Health Problem

+ The [American Public Health Association (APHA)](https://www.apha.org/topics-and-issues/gun-violence) states that gun violence "is a leading cause of premature death in the U.S." More than 38,000 individuals are killed by guns each year, and another 85,000 are injured.
+ Already in 2018, the [Gun Violence Archive](https://www.gunviolencearchive.org) has reported 52,422 gun violence incidents in the United States; 325 of these incidents were mass shootings.
+ Since 1996, the [Dickey Amendment](https://en.wikipedia.org/wiki/Dickey_Amendment) has acted as a de facto ban on gun violence research by the [Centers for Disease Control and Prevention (CDC)](https://www.cdc.gov). 

### The United States as a Product of Gun Violence...

Gun violence has drastically shaped our attitudes and our political climate. The pervasive nature of gun violence in contemporary America is evinced by a map that is entirely constructed of gun violence incident points. ***Hover over map points to get incident information.***

```{r, echo=FALSE}
gun_v_tidy %>%
	filter(state != "Alaska", state != "Hawaii", longitude < 0) %>% 
	mutate(n_affected_cat = ifelse(n_affected %in% 4:9, 2,
													ifelse(n_affected %in% 10:19, 3,
													ifelse(n_affected %in% 20:34, 4,
													ifelse(n_affected %in% 35:49, 5,
													ifelse(n_affected > 50, 6, 1)))))) %>% 
	mutate(n_affected_cat = as.factor(n_affected_cat),
				 n_affected_cat = recode_factor(n_affected_cat, `1` = "1-3 affected", `2` = "4-9 affected", `3` = "10-19 affected", `4` = "20-34 affected", `5` = "35-49 affected", `6` = "50+ affected"),
				 city_state = str_c(city_or_county, state, sep = ", "), 
				 text_label = str_c(city_state, '\n', year,'\nKilled: ', n_killed, '\nInjured: ', n_injured)) %>% 
  plot_ly(x = ~longitude, y = ~latitude, type = "scatter", mode = "markers",
          alpha = 0.5, 
          color = ~n_affected_cat,
  				colors = "Accent",
  				text = ~text_label) %>% 
	layout(legend = list(x = 0.8, y = 0.1))
```



